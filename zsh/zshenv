#!/usr/bin/env zsh
[[ -r ~/.env ]] && emulate sh -c ". ~/.env"

(( ${+ZDOTDIR} )) || export ZDOTDIR="$XDG_CONFIG_HOME/zsh"

export SHELL="zsh"

# /etc/zprofile on macOS loads /usr/libexec/path_helper which overwrites PATH
# disable it
setopt no_global_rcs

# ==> nvim-remote
export NVIM_LISTEN_ADDRESS=/tmp/nvimsocket

# ==> colors
export BASE16_SHELL_HOOKS=$XDG_CONFIG_HOME/colors/base16-shell-hooks
export BASE16_SHELL=$XDG_CONFIG_HOME/colors/base16-shell

# ==> setup default editor
if (( $+commands[nvim] )) ; then
  export VISUAL=nvim
  export NVIM_TUI_ENABLE_TRUE_COLOR=1
elif (( $+commands[vim] )) ; then
  export VISUAL=vim
else
  echo 'could not find neovim or vim; not setting $VISUAL'
fi

# -------------
# gpg ssh agent
# -------------
if (( $+commands[gpgconf] )) ; then
  unset SSH_AGENT_PID
  if [[ -v SSH_AUTH_SOCK && "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]]; then
    export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
  fi
fi
if (( $+commands[gpg-connect-aggent] )) ; then
  if [[ -v SSH_AUTH_SOCK ]]; then
    export GPG_TTY=$(tty)
    echo "UPDATESTARTUPTTY" | gpg-connect-agent > /dev/null 2>&1
  fi
fi
